<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>WYN - DASHBOARD CLIENTE</title>
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="/w/1.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="/w/1.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="16x16"
			href="/w/1.png"
		/>

		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1"
		/>

		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" type="text/css" href="vendors/styles/core.css" />
		<link
			rel="stylesheet"
			type="text/css"
			href="vendors/styles/icon-font.min.css"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="src/plugins/datatables/css/dataTables.bootstrap4.min.css"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="src/plugins/datatables/css/responsive.bootstrap4.min.css"
		/>
		<link rel="stylesheet" type="text/css" href="vendors/styles/style.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0x0Ugau/r+PRGFNfN/P1M2k/L/W84b36d0K7+v7z/z0q0+A==" crossorigin="anonymous" referrerpolicy="no-referrer" />


        <style>
            /* Adiciona estilo para a foto de perfil no header */
            .user-icon img.profile-pic-header {
                border-radius: 50% !important; /* Usa !important para garantir que sobrescreva outros estilos */
                object-fit: cover; /* Garante que a imagem cubra o espaço */
                width: 40px; /* Garante um tamanho fixo se necessário */
                height: 40px; /* Garante um tamanho fixo se necessário */
            }

            /* Estilo para os novos botões/cards de ação */
            .action-card {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 20px;
                text-align: center;
                height: 100%; /* Garante que os cards tenham a mesma altura na linha */
                transition: transform 0.2s ease-in-out; /* Adiciona um efeito hover */
            }

            .action-card:hover {
                transform: translateY(-5px); /* Move ligeiramente para cima no hover */
            }

            .action-card .icon {
                font-size: 3rem; /* Tamanho maior para o ícone */
                margin-bottom: 15px;
            }

             .action-card h5 {
                 margin-bottom: 0;
             }

            /* Estilos para o Chatbot Box */
            #chat-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 350px;
                height: 450px;
                background-color: #fff;
                border-radius: 15px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                display: flex;
                flex-direction: column;
                overflow: hidden;
                z-index: 1000; /* Garante que esteja acima de outros elementos */
                transform: translateX(400px); /* Esconde o chat inicialmente */
                transition: transform 0.3s ease-in-out;
            }

            #chat-container.open {
                transform: translateX(0); /* Mostra o chat */
            }

            #chat-header {
                background-color: #007bff; /* Cor do cabeçalho */
                color: white;
                padding: 15px;
                font-size: 1.1em;
                font-weight: bold;
                border-top-left-radius: 15px;
                border-top-right-radius: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            #chat-close-button {
                background: none;
                border: none;
                color: white;
                font-size: 1.2em;
                cursor: pointer;
                padding: 5px;
                border-radius: 50%;
                transition: background-color 0.2s;
            }

            #chat-close-button:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }

            #chat-messages {
                flex-grow: 1;
                padding: 15px;
                overflow-y: auto;
                background-color: #f9f9f9;
                border-bottom: 1px solid #eee;
            }

            .message {
                margin-bottom: 10px;
                padding: 8px 12px;
                border-radius: 10px;
                max-width: 80%;
            }

            .message.user {
                background-color: #e0f7fa; /* Azul claro para mensagens do usuário */
                align-self: flex-end;
                margin-left: auto;
            }

            .message.bot {
                background-color: #e8f5e9; /* Verde claro para mensagens do bot */
                align-self: flex-start;
                margin-right: auto;
            }

            #chat-loading-indicator {
                padding: 10px 15px;
                font-style: italic;
                color: #555;
                text-align: center;
                background-color: #f1f1f1;
            }

            #chat-input-area {
                display: flex;
                padding: 15px;
                border-top: 1px solid #eee;
            }

            #chat-input {
                flex-grow: 1;
                border: 1px solid #ddd;
                border-radius: 20px;
                padding: 10px 15px;
                margin-right: 10px;
                font-size: 0.9em;
            }

            #chat-send-button {
                background-color: #28a745; /* Verde para o botão de enviar */
                color: white;
                border: none;
                border-radius: 20px;
                padding: 10px 15px;
                cursor: pointer;
                transition: background-color 0.2s;
            }

            #chat-send-button:hover {
                background-color: #218838;
            }

            /* Botão flutuante para abrir o chat */
            #chat-toggle-button {
                position: fixed;
                bottom: 20px;
                right: 20px;
                background-color: #007bff; /* Azul */
                color: white;
                border: none;
                border-radius: 50%;
                width: 60px;
                height: 60px;
                font-size: 2em;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
                z-index: 1001; /* Acima do chat container */
                transition: transform 0.3s ease-in-out;
            }

            #chat-toggle-button:hover {
                transform: scale(1.05);
            }

            /* Esconde o botão de toggle quando o chat está aberto */
            #chat-container.open + #chat-toggle-button {
                display: none;
            }

            /* Media queries para responsividade */
            @media (max-width: 768px) {
                #chat-container {
                    width: 90%;
                    height: 80%;
                    bottom: 5%;
                    right: 5%;
                    transform: translateX(100vw); /* Esconde para a direita na tela pequena */
                }

                #chat-container.open {
                    transform: translateX(0);
                }

                #chat-toggle-button {
                    width: 50px;
                    height: 50px;
                    font-size: 1.8em;
                    bottom: 15px;
                    right: 15px;
                }
            }

        </style>

		<script
			async
			src="https://www.googletagmanager.com/gtag/js?id=G-GBZ3SGGX85"
		></script>
		<script
			async
			src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2973766580778258"
			crossorigin="anonymous"
		></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag("js", new Date());

			gtag("config", "G-GBZ3SGGX85");
		</script>
		<script>
			(function (w, d, s, l, i) {
				w[l] = w[l] || [];
				w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
				var f = d.getElementsByTagName(s)[0],
					j = d.createElement(s),
					dl = l != "dataLayer" ? "&l=" + l : "";
				j.async = true;
				j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
				f.parentNode.insertBefore(j, f);
			})(window, document, "script", "dataLayer", "GTM-NXZMQSS");
		</script>
		</head>
	<body>
  <div class="pre-loader">
			<div class="pre-loader-box">
				<div class="loader-logo">
					<img src="w.png" alt="" />
				</div>
				<div class="loader-progress" id="progress_div">
					<div class="bar" id="bar1"></div>
				</div>
				<div class="percent" id="percent1">0%</div>
				<div class="loading-text">Carregando...</div>
			</div>
		</div>

		<div class="header">
			<div class="header-left">
				<div class="menu-icon bi bi-list"></div>
				<div
					class="search-toggle-icon bi bi-search"
					data-toggle="header_search"
				></div>
				<div class="header-search">
					<form>
						<div class="form-group mb-0">
							<i class="dw dw-search2 search-icon"></i>
							<input
								type="text"
								class="form-control search-input"
								placeholder="Search Here"
							/>
							<div class="dropdown">
								<a
									class="dropdown-toggle no-arrow"
									href="#"
									role="button"
									data-toggle="dropdown"
								>
									<i class="ion-arrow-down-c"></i>
								</a>
								<div class="dropdown-menu dropdown-menu-right">
									<div class="form-group row">
										<label class="col-sm-12 col-md-2 col-form-label"
											>De</label
										>
										<div class="col-sm-12 col-md-10">
											<input
												class="form-control form-control-sm form-control-line"
												type="text"
											/>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-sm-12 col-md-2 col-form-label">Para</label>
										<div class="col-sm-12 col-md-10">
											<input
												class="form-control form-control-sm form-control-line"
												type="text"
											/>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-sm-12 col-md-2 col-form-label"
											>Sujeito</label
										>
										<div class="col-sm-12 col-md-10">
											<input
												class="form-control form-control-sm form-control-line"
												type="text"
											/>
										</div>
									</div>
									<div class="text-right">
										<button class="btn btn-primary">Pesquisar</button>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="header-right">
				<div class="dashboard-setting user-notification">
					<div class="dropdown">
						<a
							class="dropdown-toggle no-arrow"
							href="javascript:;"
							data-toggle="right-sidebar"
						>
							<i class="dw dw-settings2"></i>
						</a>
					</div>
				</div>

				<div class="user-info-dropdown">
					<div class="dropdown">
						<a
							class="dropdown-toggle"
							href="#"
							role="button"
							data-toggle="dropdown"
						>
							<span class="user-icon">
								<img src="vendors/images/photo1.jpg" id="user-profile-pic" class="profile-pic-header" alt="" />
							</span>
							<span class="user-name">Cliente</span>
						</a>
						<div
							class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list"
						>
							<a class="dropdown-item" href="profile.html"
								><i class="dw dw-user1"></i> Perfil</a
							>
							<a class="dropdown-item" href="profile.html"
								><i class="dw dw-settings2"></i>Configurações</a
							>
							<a class="dropdown-item" href="faq.html"
								><i class="dw dw-help"></i> Ajuda</a
							>
							<a class="dropdown-item" href="#" id="logout-link"
								><i class="dw dw-logout"></i> Sair</a
							>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="right-sidebar">
			<div class="sidebar-title">
				<h3 class="weight-600 font-16 text-blue">
					Configuração de Layout
					<span class="btn-block font-weight-400 font-12"
						>Personalização</span
					>
				</h3>
				<div class="close-sidebar" data-toggle="right-sidebar-close">
					<i class="icon-copy ion-close-round"></i>
				</div>
			</div>
			<div class="right-sidebar-body customscroll">
				<div class="right-sidebar-body-content">
					<h4 class="weight-600 font-18 pb-10">Fundo</h4>
					<div class="sidebar-btn-group pb-30 mb-10">
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary header-white active"
							>Claro</a
						>
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary header-dark"
							>Escuro</a
						>
					</div>

					<h4 class="weight-600 font-18 pb-10">Menu Lateral</h4>
					<div class="sidebar-btn-group pb-30 mb-10">
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary sidebar-light"
							>Claro</a
						>
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary sidebar-dark active"
							>Escuro</a
						>
					</div>

					<h4 class="weight-600 font-18 pb-10">Icone Dropdown</h4>
					<div class="sidebar-radio-group pb-10 mb-10">
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebaricon-1"
								name="menu-dropdown-icon"
								class="custom-control-input"
								value="icon-style-1"
								checked=""
							/>
							<label class="custom-control-label" for="sidebaricon-1"
								><i class="fa fa-angle-down"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebaricon-2"
								name="menu-dropdown-icon"
								class="custom-control-input"
								value="icon-style-2"
							/>
							<label class="custom-control-label" for="sidebaricon-2"
								><i class="ion-plus-round"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-3"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-3"
							/>
							<label class="custom-control-label" for="sidebariconlist-3"
								><i class="fa fa-angle-double-right"></i
							></label>
						</div>
					</div>

					<h4 class="weight-600 font-18 pb-10">Icones do Menu</h4>
					<div class="sidebar-radio-group pb-30 mb-10">
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-1"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-1"
								checked=""
							/>
							<label class="custom-control-label" for="sidebariconlist-1"
								><i class="ion-minus-round"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-2"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-2"
							/>
							<label class="custom-control-label" for="sidebariconlist-2"
								><i class="fa fa-circle-o" aria-hidden="true"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-3"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-3"
							/>
							<label class="custom-control-label" for="sidebariconlist-3"
								><i class="dw dw-check"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-4"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-4"
								checked=""
							/>
							<label class="custom-control-label" for="sidebariconlist-4"
								><i class="icon-copy dw dw-next-2"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-5"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-5"
							/>
							<label class="custom-control-label" for="sidebariconlist-5"
								><i class="dw dw-fast-forward-1"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-6"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-6"
							/>
							<label class="custom-control-label" for="sidebariconlist-6"
								><i class="dw dw-next"></i
							></label>
						</div>
					</div>

					<div class="reset-options pt-30 text-center">
						<button class="btn btn-danger" id="reset-settings">
							Resetar Configurações
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="left-side-bar">
			<div class="brand-logo">
				<a href="indexx.html"> <img src="w (1).png" alt="" class="dark-logo" />
					<img
						src="w (1).png"
						alt=""
						class="light-logo"
					/>
				</a>
				<div class="close-sidebar" data-toggle="left-sidebar-close">
					<i class="ion-close-round"></i>
				</div>
			</div>
			<div class="menu-block customscroll">
				<div class="sidebar-menu">
					<ul id="accordion-menu">
						<li>
							<a href="indexx.html" class="dropdown-toggle no-arrow active">
                                <span class="micon bi bi-house"></span
								><span class="mtext">Dashboard</span>
							</a>
						</li>
						<li>
							<a href="catalogo.html" class="dropdown-toggle no-arrow"> <span class="micon bi bi-grid"></span
								><span class="mtext">Catálogo de Serviços</span>
							</a>
						</li>
						<li>
							<a href="contratos.html" class="dropdown-toggle no-arrow">
                                <span class="micon bi bi-journal-check"></span
								><span class="mtext">Meus Pedidos</span>
							</a>
						</li>
                        <li>
							<a href="chat-list.html" class="dropdown-toggle no-arrow">
                                <span class="micon bi bi-chat-dots"></span>
                                <span class="mtext">Chat de Pedidos</span>
                                <span id="unread-chat-count-sidebar-cliente" class="badge badge-pill badge-danger" style="display: none; margin-left: 5px;">0</span>
                            </a>
                        </li>
                         <li>
							<a href="avaliar-prestador.html" class="dropdown-toggle no-arrow">
                                <span class="micon bi bi-star-fill"></span>
                                <span class="mtext">Avaliar Prestadores</span>
                            </a>
                        </li>
                         <li>
							<a href="profile.html" class="dropdown-toggle no-arrow">
                                <span class="micon bi bi-person"></span>
                                <span class="mtext">Meu Perfil</span>
                            </a>
                        </li>

						<li class="dropdown">
							<a href="javascript:;" class="dropdown-toggle">
								<span class="micon bi bi-file-pdf"></span
								><span class="mtext">Documentação</span>
							</a>
							<ul class="submenu">
								<li><a href="/Tela Inicial copy/Termos e Condições.docx">Termos e Condições</a></li>
								</ul>
						</li>
						</ul>
				</div>
			</div>
		</div>
		<div class="mobile-menu-overlay"></div>
		<div class="main-container">
			<div class="xs-pd-20-10 pd-ltr-20">
				<div class="title pb-20">
					<div class="welcome-message card-box p-4 mb-20">
						<h1 class="h3 text-center mb-20">Bem-vindo à Plataforma WYN</h1>
						<p class="text-center font-16">Estamos felizes em tê-lo aqui. Use nosso painel para gerenciar suas solicitações.</p>
					</div>

                    <div class="row pb-20">
                        <div class="col-md-6 mb-20">
                            <a href="catalogo.html" style="text-decoration: none;">
                                <div class="card-box height-100-p action-card bg-primary text-white">
                                     <div class="icon">
                                         <i class="dw dw-add"></i> </div>
                                    <h5 class="text-white">Fazer Novo Pedido</h5>
                                    <p class="text-white-50">Explore os serviços disponíveis e solicite um novo.</p>
                                </div>
                            </a>
                        </div>
                         <div class="col-md-6 mb-20">
                            <a href="contratos.html" style="text-decoration: none;">
                                <div class="card-box height-100-p action-card bg-secondary text-white">
                                     <div class="icon">
                                         <i class="dw dw-list3"></i> </div>
                                    <h5 class="text-white">Ver Meus Pedidos</h5>
                                    <p class="text-white-50">Acompanhe o status dos seus pedidos, pagamentos e avaliações.</p>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div>
						<h2 class="h3 mb-0">Visão Geral dos Pedidos</h2>
					</div>

					<div class="row pb-10">
						<div class="col-xl-3 col-lg-3 col-md-6 mb-20">
							<a href="contratos.html" style="text-decoration: none;"> <div class="card-box height-100-p widget-style3 cursor-pointer">
									<div class="d-flex flex-wrap">
										<div class="widget-data">
											<div class="weight-700 font-24 text-dark" id="total-solicitados">0</div>
											<div class="font-14 text-secondary weight-500">Solicitações</div>
										</div>
										<div class="widget-icon">
											<div class="icon" data-color="#00eccf">
												<i class="icon-copy dw dw-calendar1"></i>
											</div>
										</div>
									</div>
								</div>
							</a>
						</div>

						<div class="col-xl-3 col-lg-3 col-md-6 mb-20">
							<a href="contratos.html?status=pendente" style="text-decoration: none;">
								<div class="card-box height-100-p widget-style3 cursor-pointer">
									<div class="d-flex flex-wrap">
										<div class="widget-data">
											<div class="weight-700 font-24 text-dark" id="total-pendentes">0</div>
											<div class="font-14 text-secondary weight-500">Pedidos Pendentes</div>
										</div>
										<div class="widget-icon">
											<div class="icon" data-color="#f39c12">
												<i class="icon-copy dw dw-clock"></i>
											</div>
										</div>
									</div>
								</div>
							</a>
						</div>

						<div class="col-xl-3 col-lg-3 col-md-6 mb-20">
							<a href="contratos.html?status=concluido" style="text-decoration: none;"> <div class="card-box height-100-p widget-style3 cursor-pointer">
									<div class="d-flex flex-wrap">
										<div class="widget-data">
											<div class="weight-700 font-24 text-dark" id="total-concluidos">0</div>
											<div class="font-14 text-secondary weight-500">Serviços Concluídos</div>
										</div>
										<div class="widget-icon">
											<div class="icon" data-color="#2ecc71">
												<i class="icon-copy dw dw-check"></i>
											</div>
										</div>
									</div>
								</div>
							</a>
						</div>

						<div class="col-xl-3 col-lg-3 col-md-6 mb-20">
							<a href="avaliar-prestador.html" style="text-decoration: none;"> <div class="card-box height-100-p widget-style3 cursor-pointer">
									<div class="d-flex flex-wrap">
										<div class="widget-data">
											<div class="weight-700 font-24 text-dark" id="total-avaliacoes">0</div>
											<div class="font-14 text-secondary weight-500">Avaliações Pendentes</div>
										</div>
										<div class="widget-icon">
											<div class="icon" data-color="#f1c40f">
												<i class="icon-copy dw dw-star"></i>
											</div>
										</div>
									</div>
								</div>
							</a>
						</div>
                         <div class="col-xl-3 col-lg-3 col-md-6 mb-20">
                             <div class="card-box height-100-p widget-style3">
                                 <div class="d-flex flex-wrap">
                                     <div class="widget-data">
                                         <div class="weight-700 font-24 text-dark" id="total-notificacoes">0</div>
                                         <div class="font-14 text-secondary weight-500">Notificações</div>
                                     </div>
                                     <div class="widget-icon">
                                         <div class="icon" data-color="#3498db">
                                             <i class="icon-copy dw dw-notification"></i>
                                         </div>
                                     </div>
                                 </div>
                             </div>
                         </div>
                         <div class="col-xl-3 col-lg-3 col-md-6 mb-20">
                             <div class="card-box height-100-p widget-style3">
                                 <div class="d-flex flex-wrap">
                                     <div class="widget-data">
                                         <div class="weight-700 font-24 text-dark" id="valor-total">R$ 0.00</div>
                                         <div class="font-14 text-secondary weight-500">Valor Total de Pedidos</div>
                                     </div>
                                     <div class="widget-icon">
                                         <div class="icon" data-color="#9b59b6">
                                             <i class="icon-copy dw dw-money-2"></i>
                                         </div>
                                     </div>
                                 </div>
                             </div>
                         </div>
                         <div class="col-xl-3 col-lg-3 col-md-6 mb-20">
                             <div class="card-box height-100-p widget-style3">
                                 <div class="d-flex flex-wrap">
                                     <div class="widget-data">
                                         <div class="weight-700 font-24 text-dark" id="total-mensagens">0</div>
                                         <div class="font-14 text-secondary weight-500">Mensagens Não Lidas</div>
                                     </div>
                                     <div class="widget-icon">
                                         <div class="icon" data-color="#e74c3c">
                                             <i class="icon-copy dw dw-chat"></i>
                                         </div>
                                     </div>
                                 </div>
                             </div>
                         </div>
                    </div>
				</div>

				<div class="footer-wrap pd-20 mb-20 card-box">
					Plataforma WYN-TECH
				</div>
			</div>
		</div>

        <button id="chat-toggle-button" class="btn btn-primary"><i class="icon-copy dw dw-chat"></i></button>

        <div id="chat-container">
            <div id="chat-header">
                Chatbot WYN
                <button id="chat-close-button">&times;</button>
            </div>
            <div id="chat-messages">
                <div class="message bot">Olá! Como posso ajudar você hoje?</div>
            </div>
            <div id="chat-loading-indicator" style="display: none;">Digitando...</div>
            <div id="chat-input-area">
                <input type="text" id="chat-input" placeholder="Digite sua mensagem...">
                <button id="chat-send-button">Enviar</button>
            </div>
        </div>

		<script src="vendors/scripts/core.js"></script>
		<script src="vendors/scripts/script.min.js"></script>
		<script src="vendors/scripts/process.js"></script>
		<script src="vendors/scripts/layout-settings.js"></script>
		<script src="src/plugins/datatables/js/jquery.dataTables.min.js"></script>
		<script src="src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
		<script src="src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>
		<script>
			let usuarioLogado = null; // Variável para armazenar os dados do usuário logado
            let unreadMessagesPollingInterval = null; // Variável para o intervalo de polling de mensagens não lidas
            // URL base do seu backend (ajuste se necessário)
            const BACKEND_BASE_URL = 'https://wyn-backend.onrender.com';
            const DEFAULT_USER_PIC = 'vendors/images/photo1.jpg'; // Imagem padrão para usuário


            // Função para exibir toast notifications (pode ser reutilizada de profile.html)
            function showToast(message, type = 'success') {
                const toastContainer = document.getElementById('toastContainer');
                if (!toastContainer) {
                    // Cria o container se não existir
                    const newToastContainer = document.createElement('div');
                    newToastContainer.id = 'toastContainer';
                    newToastContainer.style.position = 'fixed';
                    newToastContainer.style.top = '20px';
                    newToastContainer.style.right = '20px';
                    newToastContainer.style.zIndex = '1050';
                    document.body.appendChild(newToastContainer);
                }

                const toastElement = document.createElement('div');
                toastElement.classList.add('toast');
                toastElement.setAttribute('role', 'alert');
                toastElement.setAttribute('aria-live', 'assertive');
                toastElement.setAttribute('aria-atomic', 'true');
                toastElement.setAttribute('data-delay', '5000');

                toastElement.innerHTML = `
                    <div class="toast-header ${type === 'success' ? 'bg-success text-white' : type === 'danger' ? 'bg-danger text-white' : 'bg-info text-white'}">
                        <strong class="mr-auto">${type === 'success' ? 'Sucesso' : type === 'danger' ? 'Erro' : 'Informação'}</strong>
                        <small>Agora</small>
                        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                `;

                document.getElementById('toastContainer').appendChild(toastElement);
                // Usa jQuery para o funcionamento do toast (necessário incluir jQuery e Bootstrap JS)
                $(toastElement).toast('show');
                $(toastElement).on('hidden.bs.toast', function () {
                    $(this).remove();
                });
            }


            async function carregarPerfilUsuario() {
                const token = localStorage.getItem('token');
                const usuarioCache = localStorage.getItem('usuario'); // Chave correta para usuário

                if (!token || !usuarioCache) {
                    console.warn("Usuário não autenticado. Redirecionando para login.");
                    window.location.href = "login.html"; // Redirecionar para login do usuário
                    return;
                }

                try {
                    // Parse do cache para obter o ID e nome rapidamente
                    usuarioLogado = JSON.parse(usuarioCache);
                    const nomeSpan = document.querySelector(".user-name");
                    const userProfilePicImg = document.getElementById("user-profile-pic"); // Pega a tag img da foto

                    if (nomeSpan && usuarioLogado?.nome) {
                        nomeSpan.textContent = usuarioLogado.nome;
                    }
                    // Exibe a foto de perfil do cache se existir
                    if (userProfilePicImg && usuarioLogado?.foto_perfil_url) {
                        userProfilePicImg.src = usuarioLogado.foto_perfil_url;
                        userProfilePicImg.onerror = function() {
                            // Fallback para imagem padrão se a URL da foto falhar
                            this.onerror = null; // Evita loop infinito de erro
                            this.src = DEFAULT_USER_PIC;
                        };
                    } else if (userProfilePicImg) {
                        // Se não houver foto no cache, usa a imagem padrão
                        userProfilePicImg.src = DEFAULT_USER_PIC;
                    }

                    // Chamada ao backend para validar o token e obter dados completos
                    // Usando a rota /perfil que agora verifica o tipo no token
                    // --- URL ATUALIZADA PARA O BACKEND NO RENDER ---
                    const res = await fetch(`${BACKEND_BASE_URL}/perfil`, {
                        headers: { 'Authorization': 'Bearer ' + token }
                    });

                    const resClone = res.clone(); // Clonar para ler o body se der erro de JSON

                    if (!res.ok) {
                        if (res.status === 401 || res.status === 403) {
                            console.error("Token inválido ou expirado. Redirecionando para login.");
                            // Substituído alert por showToast
                            showToast("Sua sessão expirou. Por favor, faça login novamente.", 'danger');
                            window.location.href = "login.html";
                            return;
                        }
                        const errorText = await resClone.text();
                        console.error("Erro HTTP ao buscar perfil:", res.status, errorText);
                        throw new Error(`Erro HTTP ao buscar perfil: ${res.status}`);
                    }

                    let data = {};
                    try {
                        data = await res.json();
                    } catch(jsonError) {
                        console.error("Erro ao parsear JSON do perfil:", await resClone.text());
                        throw new Error("Resposta de perfil inválida.");
                    }

                    // Verifique se o perfil retornado é de um usuário cliente
                    if (data.tipo !== 'usuario' || !data.usuario?._id) {
                        console.error("Token válido, mas não corresponde a um usuário cliente.");
                        // Substituído alert por showToast
                        showToast("Acesso negado para este tipo de usuário.", 'danger');
                        window.location.href = "login-prestador.html"; // Redireciona para login do prestador se for prestador
                        return;
                    }

                    // Atualiza a variável global com os dados completos do usuário
                    usuarioLogado = data.usuario;

                    // Atualiza o nome na interface (se a chamada backend for bem sucedida)
                    if (usuarioLogado?.nome && nomeSpan) {
                        nomeSpan.textContent = usuarioLogado.nome;
                    }
                    // Atualiza a foto de perfil com a URL retornada pelo backend
                    if (userProfilePicImg && usuarioLogado?.foto_perfil_url) {
                        userProfilePicImg.src = usuarioLogado.foto_perfil_url;
                        userProfilePicImg.onerror = function() {
                            this.onerror = null; // Evita loop infinito de erro
                            this.src = DEFAULT_USER_PIC;
                        };
                    } else if (userProfilePicImg) {
                        // Se não houver foto no cache, usa a imagem padrão
                        userProfilePicImg.src = DEFAULT_USER_PIC;
                    }

                    console.log("Perfil do usuário carregado:", usuarioLogado);

                    // Carregar contadores do dashboard
                    carregarContadoresUsuario();
                    // Iniciar polling para mensagens não lidas
                    iniciarPollingMensagensNaoLidas();

                } catch (err) {
                    console.error('Erro ao carregar perfil do usuário:', err);
                    if (usuarioLogado) {
                        showToast('Erro ao validar sessão do usuário. Pode haver problemas na conexão.', 'danger');
                    } else {
                        showToast('Ocorreu um erro ao carregar informações do usuário.', 'danger');
                    }
                }
            }

            // Função para carregar os contadores do dashboard do cliente
            async function carregarContadoresUsuario() {
                const token = localStorage.getItem('token');
                if (!token) return;

                try {
                    // Total de Solicitações
                    const resTotal = await fetch(`${BACKEND_BASE_URL}/meus-servicos`, { headers: { 'Authorization': `Bearer ${token}` } });
                    const dataTotal = await resTotal.json();
                    document.getElementById('total-solicitados').textContent = dataTotal.length || 0;

                    // Pedidos Pendentes (aguardando aceite do prestador, aguardando pagamento, recusado, cancelado)
                    const resPendentes = await fetch(`${BACKEND_BASE_URL}/meus-servicos`, { headers: { 'Authorization': `Bearer ${token}` } });
                    const dataPendentes = await resPendentes.json();
                    const pendentes = dataPendentes.filter(s =>
                        s.status === 'aguardando_aceite_prestador' ||
                        s.status === 'aguardando_pagamento_cliente' ||
                        s.status === 'recusado_pelo_prestador' ||
                        s.status === 'cancelado'
                    );
                    document.getElementById('total-pendentes').textContent = pendentes.length || 0;

                    // Serviços Concluídos
                    const resConcluidos = await fetch(`${BACKEND_BASE_URL}/meus-servicos`, { headers: { 'Authorization': `Bearer ${token}` } });
                    const dataConcluidos = await resConcluidos.json();
                    const concluidos = dataConcluidos.filter(s => s.status === 'concluido_pelo_prestador' || s.status === 'avaliado_pelo_cliente');
                    document.getElementById('total-concluidos').textContent = concluidos.length || 0;

                    // Avaliações Pendentes (serviços concluídos que ainda não foram avaliados)
                    const resAvaliacoesPendentes = await fetch(`${BACKEND_BASE_URL}/pedidos-para-avaliar`, { headers: { 'Authorization': `Bearer ${token}` } });
                    const dataAvaliacoesPendentes = await resAvaliacoesPendentes.json();
                    document.getElementById('total-avaliacoes').textContent = dataAvaliacoesPendentes.length || 0;

                    // Valor Total de Pedidos (apenas concluídos e avaliados com valor)
                    const valorTotal = concluidos.reduce((sum, s) => sum + (s.valor_servico || 0), 0);
                    document.getElementById('valor-total').textContent = `R$ ${valorTotal.toFixed(2).replace('.', ',')}`;

                    // Mensagens Não Lidas (do chat)
                    const resUnreadMessages = await fetch(`${BACKEND_BASE_URL}/api/chat/unread-count-for-user`, { headers: { 'Authorization': `Bearer ${token}` } });
                    const dataUnreadMessages = await resUnreadMessages.json();
                    document.getElementById('total-mensagens').textContent = dataUnreadMessages.total || 0;
                    // Atualiza o badge da sidebar também
                    const unreadChatCountSidebar = document.getElementById('unread-chat-count-sidebar-cliente');
                    if (unreadChatCountSidebar) {
                        if (dataUnreadMessages.total > 0) {
                            unreadChatCountSidebar.textContent = dataUnreadMessages.total;
                            unreadChatCountSidebar.style.display = 'inline';
                        } else {
                            unreadChatCountSidebar.style.display = 'none';
                        }
                    }

                    // Notificações (se houver um endpoint para isso)
                    // Se você tiver um endpoint para contar notificações gerais, adicione-o aqui.
                    // Por enquanto, vamos usar um placeholder ou uma contagem dummy.
                    // const resNotificacoes = await fetch(`${BACKEND_BASE_URL}/api/notifications/usuario/count`, { headers: { 'Authorization': `Bearer ${token}` } });
                    // const dataNotificacoes = await resNotificacoes.json();
                    document.getElementById('total-notificacoes').textContent = '0'; // Placeholder


                } catch (error) {
                    console.error("Erro ao carregar contadores do usuário:", error);
                    // showToast("Erro ao carregar alguns dados do dashboard.", 'danger'); // Evita spam de toast
                }
            }

            // Função para iniciar o polling de mensagens não lidas
            function iniciarPollingMensagensNaoLidas() {
                // Limpa qualquer intervalo existente para evitar duplicação
                if (unreadMessagesPollingInterval) {
                    clearInterval(unreadMessagesPollingInterval);
                }
                // Inicia o polling
                unreadMessagesPollingInterval = setInterval(() => {
                    console.log("Verificando mensagens não lidas...");
                    carregarContadoresUsuario(); // Chama a função que atualiza a contagem de mensagens
                }, 30000); // A cada 30 segundos (pode ajustar)
                console.log("Polling de mensagens não lidas iniciado.");
            }

            // Função para parar o polling de mensagens não lidas
            function pararPollingMensagensNaoLidas() {
                if (unreadMessagesPollingInterval) {
                    clearInterval(unreadMessagesPollingInterval);
                    unreadMessagesPollingInterval = null;
                    console.log("Polling de mensagens não lidas parado.");
                }
            }


			// Função de Logout
			document.getElementById('logout-link').addEventListener('click', (e) => {
				e.preventDefault();
				localStorage.removeItem('token');
				localStorage.removeItem('usuario'); // Remove o cache específico do usuário
                pararPollingMensagensNaoLidas(); // Para o polling ao deslogar
				window.location.href = "login.html";
			});

			// Chamar loadProfile ao carregar a página
			document.addEventListener("DOMContentLoaded", carregarPerfilUsuario);

            // Event listener para o botão de toggle (abrir/fechar chat)
            const chatToggleButton = document.getElementById('chat-toggle-button');
            const chatContainer = document.getElementById('chat-container');
            const chatInput = document.getElementById('chat-input');
            const chatSendButton = document.getElementById('chat-send-button');
            const chatCloseButton = document.getElementById('chat-close-button');
            const chatMessages = document.getElementById('chat-messages');
            const chatLoadingIndicator = document.getElementById('chat-loading-indicator');

            let chatHistory = []; // Armazena o histórico do chat

            // Função para adicionar mensagem ao chat UI
            function addMessageToChat(sender, message) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', sender);
                messageElement.textContent = message;
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight; // Rola para a última mensagem
            }

            // Função para enviar mensagem para a IA
            async function sendMessageToAI() {
                const userMessage = chatInput.value.trim();
                if (userMessage === '') return;

                addMessageToChat('user', userMessage);
                chatInput.value = ''; // Limpa o input
                chatLoadingIndicator.style.display = 'block'; // Mostra indicador de carregamento
                chatMessages.scrollTop = chatMessages.scrollHeight; // Rola para a última mensagem

                // Adiciona a mensagem do usuário ao histórico
                chatHistory.push({ role: "user", parts: [{ text: userMessage }] });

                try {
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // Deixe vazio, o Canvas fornecerá a chave em tempo de execução
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const botMessage = result.candidates[0].content.parts[0].text;
                        addMessageToChat('bot', botMessage);
                        chatHistory.push({ role: "model", parts: [{ text: botMessage }] }); // Adiciona a resposta do bot ao histórico
                    } else {
                        addMessageToChat('bot', 'Desculpe, não consegui gerar uma resposta. Tente novamente.');
                        console.error('Estrutura de resposta da API Gemini inesperada:', result);
                    }
                } catch (error) {
                    console.error('Erro ao chamar a API Gemini:', error);
                    addMessageToChat('bot', 'Ocorreu um erro ao se comunicar com a IA. Por favor, tente novamente mais tarde.');
                } finally {
                    chatLoadingIndicator.style.display = 'none'; // Esconde indicador de carregamento
                    chatMessages.scrollTop = chatMessages.scrollHeight; // Rola para a última mensagem novamente
                }
            }

            // Event listener para o botão de toggle (abrir/fechar chat)
            // Verifique se o elemento existe antes de adicionar o listener
            if (chatToggleButton) {
                chatToggleButton.addEventListener('click', () => {
                    chatContainer.classList.toggle('open');
                    if (chatContainer.classList.contains('open')) {
                        chatInput.focus(); // Foca no input quando abre
                    }
                });
            } else {
                console.warn("Elemento #chat-toggle-button não encontrado. Verifique se o botão flutuante está no HTML.");
            }


            // Event listener para o botão de fechar o chat
            if (chatCloseButton) {
                chatCloseButton.addEventListener('click', () => {
                    chatContainer.classList.remove('open');
                });
            } else {
                console.warn("Elemento #chat-close-button não encontrado.");
            }

            // Event listener para o botão de enviar mensagem
            if (chatSendButton) {
                chatSendButton.addEventListener('click', sendMessageToAI);
            } else {
                console.warn("Elemento #chat-send-button não encontrado.");
            }

            // Event listener para a tecla Enter no campo de input
            if (chatInput) {
                chatInput.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter') {
                        sendMessageToAI();
                    }
                });
            } else {
                console.warn("Elemento #chat-input não encontrado.");
            }
		</script>

</body>
</html>
