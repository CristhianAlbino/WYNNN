<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>WYN - Gerenciar Serviços</title>
		<link rel="apple-touch-icon" sizes="180x180" href="/w/1.png" />
		<link rel="icon" type="image/png" sizes="32x32" href="/w/1.png" />
		<link rel="icon" type="image/png" sizes="16x16" href="/w/1.png" />

		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1"
		/>

		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" type="text/css" href="vendors/styles/core.css" />
		<link
			rel="stylesheet"
			type="text/css"
			href="vendors/styles/icon-font.min.css"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="src/plugins/datatables/css/dataTables.bootstrap4.min.css"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="src/plugins/datatables/css/responsive.bootstrap4.min.css"
		/>
		<link rel="stylesheet" type="text/css" href="vendors/styles/style.css" />

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


		<style>
			/* Estilo para a foto de perfil no header */
			.user-icon img.profile-pic-header {
				border-radius: 50% !important;
				object-fit: cover;
				width: 40px;
				height: 40px;
			}

            /* Estilo para mensagens de feedback (loading, erro, vazio) */
			.feedback-message {
				text-align: center;
				padding: 10px;
				margin: 15px 20px; /* Espaçamento alinhado com o conteúdo */
				border-radius: 4px;
				font-weight: 500;
			}

			.feedback-loading {
				color: #007bff; /* Cor azul */
				background-color: #e9f5ff; /* Fundo azul claro */
				border: 1px solid #b8daff;
			}

			.feedback-error {
				color: #dc3545; /* Cor vermelha */
				background-color: #f8d7da; /* Fundo vermelho claro */
				border: 1px solid #f5c6cb;
			}

			.feedback-empty {
				color: #6c757d; /* Cor cinza */
				background-color: #f8f9fa; /* Fundo branco/claro */
				border: 1px solid #dee2e6;
			}

             /* Estilo para o indicador de notificações no sino */
            .notification-badge {
                position: absolute;
                top: 5px; /* Ajuste a posição vertical */
                right: 5px; /* Ajuste a posição horizontal */
                padding: 3px 6px;
                border-radius: 50%;
                background-color: red;
                color: white;
                font-size: 10px;
                font-weight: bold;
                display: none; /* Inicialmente oculto */
            }

             /* Estilo para o dropdown de notificações */
             .notification-dropdown {
                 width: 300px; /* Largura fixa para o dropdown */
                 max-height: 400px; /* Altura máxima */
                 overflow-y: auto; /* Scroll se necessário */
             }

             .notification-item {
                 padding: 10px;
                 border-bottom: 1px solid #eee;
             }

             .notification-item:last-child {
                 border-bottom: none;
             }

             .notification-item a {
                 text-decoration: none;
                 color: #333; /* Cor do texto */
                 display: block; /* Ocupa toda a área do item */
             }

             .notification-item a:hover {
                 background-color: #f8f9fa; /* Fundo suave no hover */
             }

             .notification-item .timestamp {
                 font-size: 11px;
                 color: #999;
                 display: block;
                 margin-top: 3px;
             }

             .notification-item.unread {
                 background-color: #e9f5ff; /* Fundo azul claro para não lidas */
                 font-weight: bold;
             }

             /* Estilo para o container de toasts */
             #toastContainer {
                 position: fixed;
                 top: 20px;
                 right: 20px;
                 z-index: 1050; /* Acima de modais */
             }

             /* Estilo individual do toast */
             .toast {
                 width: 300px;
                 max-width: 100%;
                 font-size: .875rem;
                 background-color: rgba(255,255,255,.85);
                 background-clip: padding-box;
                 border: 1px solid rgba(0,0,0,.1);
                 box-shadow: 0 .25rem .75rem rgba(0,0,0,.1);
                 opacity: 0;
                 border-radius: .25rem;
             }

             .toast.showing {
                 opacity: 1;
             }

             .toast.show {
                 display: block;
                 opacity: 1;
             }

             .toast.hide {
                 display: none;
             }

             .toast-header {
                 display: flex;
                 align-items: center;
                 padding: .25rem .75rem;
                 color: #6c757d;
                 background-color: rgba(255,255,255,.85);
                 background-clip: padding-box;
                 border-bottom: 1px solid rgba(0,0,0,.05);
                 border-top-left-radius: calc(.25rem - 1px);
                 border-top-right-radius: calc(.25rem - 1px);
             }

             .toast-body {
                 padding: .75rem;
             }

             /* Cores para os headers dos toasts */
             .toast-header.bg-success { background-color: #28a745 !important; color: white !important; }
             .toast-header.bg-danger { background-color: #dc3545 !important; color: white !important; }
             .toast-header.bg-info { background-color: #17a2b8 !important; color: white !important; }

             /* Estilos específicos para a página Gerenciar Serviços */
             .services-management-section {
                 padding: 20px;
             }

             .service-item {
                 border: 1px solid #eee;
                 padding: 15px;
                 margin-bottom: 15px;
                 border-radius: 4px;
                 background-color: #fff;
                 display: flex;
                 justify-content: space-between;
                 align-items: center;
                 flex-wrap: wrap; /* Permite quebra em telas pequenas */
             }

             .service-details {
                 flex-grow: 1; /* Permite que os detalhes ocupem o espaço disponível */
                 margin-right: 15px; /* Espaço entre detalhes e botões */
             }

             .service-details h6 {
                 margin-bottom: 5px;
                 font-weight: 600;
             }

             .service-details p {
                 margin-bottom: 5px;
                 font-size: 14px;
                 color: #555;
             }

             .service-actions {
                 display: flex;
                 gap: 10px; /* Espaço entre os botões de ação */
             }

             @media (max-width: 576px) {
                 .service-item {
                     flex-direction: column; /* Empilha em telas muito pequenas */
                     align-items: flex-start;
                 }
                 .service-details {
                     margin-right: 0;
                     margin-bottom: 10px; /* Espaço entre detalhes e botões empilhados */
                     width: 100%; /* Ocupa largura total */
                 }
                 .service-actions {
                     width: 100%; /* Ocupa largura total */
                     justify-content: flex-end; /* Alinha botões à direita */
                 }
             }


		</style>


		<script
			async
			src="https://www.googletagmanager.com/gtag/js?id=G-GBZ3SGGX85"
		></script>
		<script
			async
			src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2973766580778258"
			crossorigin="anonymous"
		></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag("js", new Date());

			gtag("config", "G-GBZ3SGGX85");
		</script>
		<script>
			(function (w, d, s, l, i) {
				w[l] = w[l] || [];
				w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
				var f = d.getElementsByTagName(s)[0],
					j = d.createElement(s),
					dl = l != "dataLayer" ? "&l=" + l : "";
				j.async = true;
				j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
				f.parentNode.insertBefore(j, f);
			})(window, document, "script", "dataLayer", "GTM-NXZMQSS");
		</script>
	</head>
	<body>
		<div class="pre-loader">
			<div class="pre-loader-box">
				<div class="loader-logo">
					<img src="w.png" alt="" />
				</div>
				<div class="loader-progress" id="progress_div">
					<div class="bar" id="bar1"></div>
				</div>
				<div class="percent" id="percent1">0%</div>
				<div class="loading-text">Carregando...</div>
			</div>
		</div>

		<div class="header">
			<div class="header-left">
				<div class="menu-icon bi bi-list"></div>
				<div
					class="search-toggle-icon bi bi-search"
					data-toggle="header_search"
				></div>
				<div class="header-search">
					<form>
						<div class="form-group mb-0">
							<i class="dw dw-search2 search-icon"></i>
							<input
								type="text"
								class="form-control search-input"
								placeholder="Search Here"
							/>
							<div class="dropdown">
								<a
									class="dropdown-toggle no-arrow"
									href="#"
									role="button"
									data-toggle="dropdown"
								>
									<i class="ion-arrow-down-c"></i>
								</a>
								<div class="dropdown-menu dropdown-menu-right">
									<div class="form-group row">
										<label class="col-sm-12 col-md-2 col-form-label"
											>De</label
										>
										<div class="col-sm-12 col-md-10">
											<input
												class="form-control form-control-sm form-control-line"
												type="text"
											/>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-sm-12 col-md-2 col-form-label">Para</label>
										<div class="col-sm-12 col-md-10">
											<input
												class="form-control form-control-sm form-control-line"
												type="text"
											/>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-sm-12 col-md-2 col-form-label"
											>Sujeito</label
										>
										<div class="col-sm-12 col-md-10">
											<input
												class="form-control form-control-sm form-control-line"
												type="text"
											/>
										</div>
									</div>
									<div class="text-right">
										<button class="btn btn-primary">Pesquisar</button>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="header-right">
				<div class="user-notification">
					<div class="dropdown">
						<a
							class="dropdown-toggle no-arrow"
							href="#"
							role="button"
							data-toggle="dropdown"
						>
							<i class="icon-copy dw dw-notification"></i>
							<span class="badge notification-badge" id="notification-count">0</span> </a>
						<div class="dropdown-menu dropdown-menu-right dropdown-menu-lg notification-dropdown customscroll">
							<h4 class="mb-0">Notificações</h4>
							<div id="notification-list">
								<a class="dropdown-item notification-item" href="#">
									<i class="icon-copy dw dw-info"></i>
									<p>Nenhuma notificação nova.</p>
                                    <span class="timestamp">Agora</span>
								</a>
							</div>
                             <div class="text-center">
                                 <a href="#" class="btn btn-sm btn-link">Ver todas as notificações</a>
                             </div>
						</div>
					</div>
				</div>

				<div class="dashboard-setting user-notification">
					<div class="dropdown">
						<a
							class="dropdown-toggle no-arrow"
							href="javascript:;"
							data-toggle="right-sidebar"
						>
							<i class="dw dw-settings2"></i>
						</a>
					</div>
				</div>

				<div class="user-info-dropdown">
					<div class="dropdown">
						<a
							class="dropdown-toggle"
							href="#"
							role="button"
							data-toggle="dropdown"
						>
							<span class="user-icon">
								<img src="vendors/images/photo4.jpg" id="prestador-profile-pic" class="profile-pic-header" alt="" />
							</span>
							<span class="user-name">Prestador</span>
						</a>
						<div
							class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list"
						>
							<a class="dropdown-item" href="prestador-profile.html"
								><i class="dw dw-user1"></i> Perfil</a
							>
							<a class="dropdown-item" href="prestador-profile.html"
								><i class="dw dw-settings2"></i>Configurações</a
							>
							<a class="dropdown-item" href="faq.html"
								><i class="dw dw-help"></i> Ajuda</a
							>
							<a class="dropdown-item" href="#" id="logout-link"
								><i class="dw dw-logout"></i> Sair</a
							>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="right-sidebar">
			<div class="sidebar-title">
				<h3 class="weight-600 font-16 text-blue">
					Configuração de Layout
					<span class="btn-block font-weight-400 font-12"
						>Personalização</span
					>
				</h3>
				<div class="close-sidebar" data-toggle="right-sidebar-close">
					<i class="icon-copy ion-close-round"></i>
				</div>
			</div>
			<div class="right-sidebar-body customscroll">
				<div class="right-sidebar-body-content">
					<h4 class="weight-600 font-18 pb-10">Fundo</h4>
					<div class="sidebar-btn-group pb-30 mb-10">
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary header-white active"
							>Claro</a
						>
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary header-dark"
							>Escuro</a
						>
					</div>

					<h4 class="weight-600 font-18 pb-10">Menu Lateral</h4>
					<div class="sidebar-btn-group pb-30 mb-10">
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary sidebar-light"
							>Claro</a
						>
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary sidebar-dark active"
							>Escuro</a
						>
					</div>

					<h4 class="weight-600 font-18 pb-10">Icone Dropdown</h4>
					<div class="sidebar-radio-group pb-10 mb-10">
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebaricon-1"
								name="menu-dropdown-icon"
								class="custom-control-input"
								value="icon-style-1"
								checked=""
							/>
							<label class="custom-control-label" for="sidebaricon-1"
								><i class="fa fa-angle-down"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebaricon-2"
								name="menu-dropdown-icon"
								class="custom-control-input"
								value="icon-style-2"
							/>
							<label class="custom-control-label" for="sidebaricon-2"
								><i class="ion-plus-round"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-3"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-3"
							/>
							<label class="custom-control-label" for="sidebariconlist-3"
								><i class="fa fa-angle-double-right"></i
							></label>
						</div>
					</div>

					<h4 class="weight-600 font-18 pb-10">Icones do Menu</h4>
					<div class="sidebar-radio-group pb-30 mb-10">
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-1"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-1"
								checked=""
							/>
							<label class="custom-control-label" for="sidebariconlist-1"
								><i class="ion-minus-round"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-2"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-2"
							/>
							<label class="custom-control-label" for="sidebariconlist-2"
								><i class="fa fa-circle-o" aria-hidden="true"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-3"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-3"
							/>
							<label class="custom-control-label" for="sidebariconlist-3"
								><i class="dw dw-check"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-4"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-4"
								checked=""
							/>
							<label class="custom-control-label" for="sidebariconlist-4"
								><i class="icon-copy dw dw-next-2"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-5"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-5"
							/>
							<label class="custom-control-label" for="sidebariconlist-5"
								><i class="dw dw-fast-forward-1"></i
							></label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
							<input
								type="radio"
								id="sidebariconlist-6"
								name="menu-list-icon"
								class="custom-control-input"
								value="icon-list-style-6"
							/>
							<label class="custom-control-label" for="sidebariconlist-6"
								><i class="dw dw-next"></i
							></label>
						</div>
					</div>

					<div class="reset-options pt-30 text-center">
						<button class="btn btn-danger" id="reset-settings">
							Resetar Configurações
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="left-side-bar">
			<div class="brand-logo">
				<a href="index.html"> <img src="w (1).png" alt="" class="dark-logo" />
					<img
						src="w (1).png"
						alt=""
						class="light-logo"
					/>
				</a>
				<div class="close-sidebar" data-toggle="left-sidebar-close">
					<i class="ion-close-round"></i>
				</div>
			</div>
			<div class="menu-block customscroll">
				<div class="sidebar-menu">
					<ul id="accordion-menu">
						<li>
							<a href="index.html" class="dropdown-toggle no-arrow">
                                <span class="micon bi bi-house"></span
								><span class="mtext">Dashboard</span>
							</a>
						</li>
						<li>
							<a href="prestador-solicitacoes.html" class="dropdown-toggle no-arrow">
                                <span class="micon bi bi-textarea-resize"></span>
								<span class="mtext">Solicitações Pendentes</span>
                                <span id="new-solicitation-indicator" class="badge badge-pill badge-danger" style="display: none; margin-left: 5px;">Novo!</span>
							</a>
						</li>
						<li>
							<a href="prestador-meus-servicos.html" class="dropdown-toggle no-arrow"> <span class="micon bi bi-check-circle"></span
								><span class="mtext">Meus Serviços Aceitos</span>
							</a>
						</li>
						<li>
							<a href="prestador-historico.html" class="dropdown-toggle no-arrow"> <span class="micon bi bi-clock-history"></span
								><span class="mtext">Histórico de Serviços</span>
							</a>
						</li>
						<li>
							<a href="prestador-avaliacoes.html" class="dropdown-toggle no-arrow"> <span class="micon bi bi-star-fill"></span
								><span class="mtext">Minhas Avaliações</span>
							</a>
						</li>
                        <li>
							<a href="prestador-gerenciar-servicos.html" class="dropdown-toggle no-arrow active"> <span class="micon bi bi-gear"></span>
                                <span class="mtext">Gerenciar Serviços</span>
                            </a>
                        </li>
                         <li>
							<a href="prestador-minha-disponibilidade.html" class="dropdown-toggle no-arrow">
                                <span class="micon bi bi-calendar-week"></span>
                                <span class="mtext">Minha Disponibilidade</span>
                            </a>
                        </li>
                         <li>
							<a href="prestador-chat-servicos.html" class="dropdown-toggle no-arrow">
                                <span class="micon bi bi-chat-dots"></span>
                                <span class="mtext">Chat de Serviços</span>
                                 <span id="unread-chat-count-sidebar" class="badge badge-pill badge-danger" style="display: none; margin-left: 5px;">0</span> </a>
                        </li>

						<li class="dropdown">
							<a href="javascript:;" class="dropdown-toggle">
								<span class="micon bi bi-file-pdf"></span
								><span class="mtext">Documentação</span>
							</a>
							<ul class="submenu">
								<li><a href="/Tela Inicial copy/Termos e Condições.docx">Termos e Condições</a></li>
								</ul>
						</li>
						</ul>
				</div>
			</div>
		</div>
		<div class="mobile-menu-overlay"></div>

		<div class="main-container">
			<div class="xs-pd-20-10 pd-ltr-20">
				 <div class="title pb-20">
					<div>
						<h2 class="h3 mb-0">Gerenciar Serviços Oferecidos</h2>
					</div>
				</div>

                <div class="card-box pb-10 mb-20 services-management-section">
                    <div class="h5 pd-20 mb-0">Meus Serviços</div>

                     <div id="services-loading" class="feedback-message feedback-loading" style="display: none;">Carregando seus serviços...</div>
                    <div id="services-feedback" class="feedback-message feedback-error" style="display: none;"></div>
                     <div id="services-empty" class="feedback-message feedback-empty" style="display: none;">Nenhum serviço cadastrado. Adicione um novo serviço abaixo.</div>


                    <div id="services-list" class="pd-20">
                        </div>

                    <div class="pd-20 text-right">
                        <button class="btn btn-success" id="add-service-btn">Adicionar Novo Serviço</button>
                    </div>

                </div>

                <div class="modal fade" id="serviceModal" tabindex="-1" role="dialog" aria-labelledby="serviceModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="serviceModalLabel">Adicionar Novo Serviço</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <form id="service-form">
                                <div class="modal-body">
                                    <input type="hidden" id="service-id">
                                    <div class="form-group">
                                        <label for="service-name">Nome do Serviço:</label>
                                        <input type="text" class="form-control" id="service-name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="service-description">Descrição:</label>
                                        <textarea class="form-control" id="service-description" rows="3"></textarea>
                                    </div>
                                     <div class="row">
                                         <div class="col-md-6 col-sm-12">
                                             <div class="form-group">
                                                 <label for="service-price-min">Faixa de Preço Mínimo (R$):</label>
                                                 <input type="number" class="form-control" id="service-price-min" step="0.01" min="0">
                                             </div>
                                         </div>
                                          <div class="col-md-6 col-sm-12">
                                             <div class="form-group">
                                                 <label for="service-price-max">Faixa de Preço Máximo (R$):</label>
                                                 <input type="number" class="form-control" id="service-price-max" step="0.01" min="0">
                                             </div>
                                         </div>
                                     </div>
                                     <div class="form-group">
                                         <label for="service-categories">Categorias (separadas por vírgula):</label>
                                         <input type="text" class="form-control" id="service-categories" placeholder="Ex: Limpeza, Residencial, Comercial">
                                     </div>
                                     </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Salvar Serviço</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>


				<div class="footer-wrap pd-20 mb-20 card-box">
					Plataforma WYN-TECH
				</div>
			</div>
		</div>

         <div id="toastContainer">
            </div>


		<script src="vendors/scripts/core.js"></script>
		<script src="vendors/scripts/script.min.js"></script>
		<script src="vendors/scripts/process.js"></script>
		<script src="vendors/scripts/layout-settings.js"></script>
		<script src="src/plugins/datatables/js/jquery.dataTables.min.js"></script>
		<script src="src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
		<script src="src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>

        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


		<noscript>
			<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NXZMQSS" height="0" width="0" style="display: none; visibility: hidden"></iframe>
		</noscript>

		<script>
			let prestadorLogado = null; // Variável para armazenar os dados do prestador logado

            // Função para exibir toast notifications (copiada do dashboard)
            function showToast(message, type = 'success') {
                const toastContainer = document.getElementById('toastContainer');
                if (!toastContainer) {
                    console.error("Toast container não encontrado!");
                    return;
                }

                const toastElement = document.createElement('div');
                toastElement.classList.add('toast');
                toastElement.setAttribute('role', 'alert');
                toastElement.setAttribute('aria-live', 'assertive');
                toastElement.setAttribute('aria-atomic', 'true');
                toastElement.setAttribute('data-delay', '5000');

                toastElement.innerHTML = `
                    <div class="toast-header ${type === 'success' ? 'bg-success text-white' : type === 'danger' ? 'bg-danger text-white' : 'bg-info text-white'}">
                        <strong class="mr-auto">${type === 'success' ? 'Sucesso' : type === 'danger' ? 'Erro' : 'Informação'}</strong>
                        <small>Agora</small>
                        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                `;

                toastContainer.appendChild(toastElement);
                $(toastElement).toast('show');
                $(toastElement).on('hidden.bs.toast', function () {
                    $(this).remove();
                });
            }

			async function carregarPerfilPrestador() {
				const token = localStorage.getItem('token');
				const prestadorCache = localStorage.getItem('prestador');

				if (!token || !prestadorCache) {
					console.warn("Prestador não autenticado. Redirecionando para login.");
					window.location.href = "login prestador.html";
					return;
				}

				try {
					 prestadorLogado = JSON.parse(prestadorCache);
					 const nomeSpan = document.querySelector(".user-name");
                     const prestadorProfilePicImg = document.getElementById("prestador-profile-pic");

					 if (nomeSpan && prestadorLogado?.nome) {
						 nomeSpan.textContent = prestadorLogado.nome;
					 }
                     if (prestadorProfilePicImg && prestadorLogado?.foto_perfil_url) {
                         prestadorProfilePicImg.src = prestadorLogado.foto_perfil_url;
                          prestadorProfilePicImg.onerror = function() {
                             this.onerror = null;
                             this.src = "vendors/images/photo4.jpg";
                         };
                     } else if (prestadorProfilePicImg) {
                          prestadorProfilePicImg.src = "vendors/images/photo4.jpg";
                     }

					 // --- URL ATUALIZADA PARA O BACKEND NO RENDER ---
					 const res = await fetch('https://wyn-backend.onrender.com/perfil', {
						 headers: { 'Authorization': 'Bearer ' + token }
					 });

					 const resClone = res.clone();

					 if (!res.ok) {
						 if (res.status === 401 || res.status === 403) {
							 console.error("Token inválido ou expirado. Redirecionando para login.");
							 showToast("Sua sessão expirou. Por favor, faça login novamente.", 'danger');
							 setTimeout(() => { window.location.href = "login prestador.html"; }, 3000);
							 return;
						 }
						  const errorText = await resClone.text();
						  console.error("Erro HTTP ao buscar perfil:", res.status, errorText);
						  throw new Error(errorText || `Erro HTTP ao buscar perfil: ${res.status}`);
					 }

					let data = {};
					 try {
						 data = await res.json();
					 } catch(jsonError) {
						 console.error("Erro ao parsear JSON do perfil:", await resClone.text());
						 throw new Error("Resposta de perfil inválida.");
					 }


					 if (data.tipo !== 'prestador' || !data.prestador?._id) {
						  console.error("Token válido, mas não corresponde a um prestador.");
						  showToast("Acesso negado para este tipo de usuário.", 'danger');
						   setTimeout(() => { window.location.href = "login.html"; }, 3000); // Redireciona para login geral/cliente
						  return;
					 }

					 prestadorLogado = data.prestador;

					if (prestadorLogado?.nome && nomeSpan) {
						nomeSpan.textContent = prestadorLogado.nome;
					}
                     if (prestadorProfilePicImg && prestadorLogado?.foto_perfil_url) {
                         prestadorProfilePicImg.src = prestadorLogado.foto_perfil_url;
                          prestadorProfilePicImg.onerror = function() {
                             this.onerror = null;
                             this.src = "vendors/images/photo4.jpg";
                         };
                     } else if (prestadorProfilePicImg) {
                          prestadorProfilePicImg.src = "vendors/images/photo4.jpg";
                     }

					console.log("Perfil do prestador carregado:", prestadorLogado);

                    // Após carregar o perfil, carregar os serviços oferecidos
                    carregarServicosOferecidos();
                    carregarContadorMensagensNaoLidas(); // Carrega contador de mensagens
                    iniciarPollingMensagensNaoLidas(); // Inicia polling para mensagens

				} catch (err) {
					console.error('Erro ao carregar perfil do prestador:', err);
					 if (prestadorLogado) {
						 showToast('Erro ao validar sessão do prestador. Pode haver problemas na conexão.', 'danger');
					 } else {
						 showToast('Ocorreu um erro ao carregar informações do prestador.', 'danger');
					 }
				}
			}

            // Função de Logout
			document.getElementById('logout-link').addEventListener('click', (e) => {
				 e.preventDefault();
				 localStorage.removeItem('token');
				 localStorage.removeItem('prestador'); // Limpa o cache do prestador
                 localStorage.removeItem('userId'); // Remover também o userId
                 pararPollingMensagensNaoLidas(); // Para o polling de mensagens
				 window.location.href = 'login prestador.html'; // Redireciona para a página de login do prestador
			});


            // Função para carregar o contador de mensagens não lidas (copiada do dashboard)
            async function carregarContadorMensagensNaoLidas() {
                 const token = localStorage.getItem("token");
                 const unreadCountElementSidebar = document.getElementById("unread-chat-count-sidebar");
                 const notificationCountElement = document.getElementById("notification-count"); // Contador no sino

                 if (!token) {
                     if (unreadCountElementSidebar) unreadCountElementSidebar.style.display = 'none';
                     if (notificationCountElement) notificationCountElement.style.display = 'none';
                     return;
                 }

                 try {
                     // --- URL ATUALIZADA PARA O BACKEND NO RENDER ---
                     const response = await fetch("https://wyn-backend.onrender.com/api/chat/unread-count", {
                         headers: { 'Authorization': `Bearer ${token}` }
                     });

                     if (!response.ok) {
                         console.error("Erro ao buscar contagem de mensagens não lidas:", response.status);
                         if (unreadCountElementSidebar) unreadCountElementSidebar.style.display = 'none';
                         if (notificationCountElement) notificationCountElement.style.display = 'none';
                         return;
                     }

                     const data = await response.json();
                     const unreadCount = data.total || 0;

                     if (unreadCountElementSidebar) {
                         if (unreadCount > 0) {
                             unreadCountElementSidebar.textContent = unreadCount;
                             unreadCountElementSidebar.style.display = 'inline';
                         } else {
                             unreadCountElementSidebar.style.display = 'none';
                         }
                     }

                      if (notificationCountElement) {
                          if (unreadCount > 0) {
                               notificationCountElement.textContent = unreadCount;
                               notificationCountElement.style.display = 'inline';
                          } else {
                               notificationCountElement.style.display = 'none';
                          }
                      }

                 } catch (error) {
                     console.error("Erro ao carregar contagem de mensagens não lidas:", error);
                      if (unreadCountElementSidebar) unreadCountElementSidebar.style.display = 'none';
                      if (notificationCountElement) notificationCountElement.style.display = 'none';
                 }
            }

             // Função para iniciar o polling de mensagens não lidas (copiada do dashboard)
             let unreadChatPollingInterval = null;
             function iniciarPollingMensagensNaoLidas() {
                 if (unreadChatPollingInterval) {
                     clearInterval(unreadChatPollingInterval);
                 }
                 unreadChatPollingInterval = setInterval(() => {
                     console.log("Verificando mensagens não lidas...");
                     carregarContadorMensagensNaoLidas();
                 }, 30000);
                 console.log("Polling de mensagens não lidas iniciado.");
             }

             // Função para parar o polling de mensagens não lidas (copiada do dashboard)
             function pararPollingMensagensNaoLidas() {
                 if (unreadChatPollingInterval) {
                     clearInterval(unreadChatPollingInterval);
                     unreadChatPollingInterval = null;
                     console.log("Polling de mensagens não lidas parado.");
                 }
             }


            // Função para carregar os serviços oferecidos pelo prestador
            async function carregarServicosOferecidos() {
                const loading = document.getElementById("services-loading");
                const feedback = document.getElementById("services-feedback");
                const empty = document.getElementById("services-empty");
                const servicesList = document.getElementById("services-list");

                loading.style.display = "block";
                feedback.style.display = "none";
                empty.style.display = "none";
                servicesList.innerHTML = ""; // Limpa a lista

                const token = localStorage.getItem("token");
                // Não precisamos do prestadorId aqui, o backend pega do token

                if (!token) {
                     feedback.textContent = "Autenticação necessária para carregar serviços.";
                     feedback.style.display = "block";
                     loading.style.display = "none";
                     return;
                }

                try {
                    // --- ROTA CORRIGIDA: Não inclui prestadorId na URL ---
                    // --- URL ATUALIZADA PARA O BACKEND NO RENDER ---
                    const response = await fetch(`https://wyn-backend.onrender.com/prestador/servicos-oferecidos`, {
                         headers: { 'Authorization': `Bearer ${token}` }
                    });

                    if (!response.ok) {
                         if (response.status === 404) {
                             console.log("Nenhum serviço encontrado para este prestador.");
                             empty.style.display = 'block';
                             loading.style.display = "none";
                             return;
                         }
                         if (response.status === 401 || response.status === 403) {
                              showToast("Sua sessão expirou ou você não tem permissão. Faça login novamente.", 'danger');
                              setTimeout(() => { window.location.href = "login prestador.html"; }, 3000);
                              return;
                         }
                         const errorText = await response.text();
                         console.error("Erro HTTP ao buscar serviços oferecidos:", response.status, errorText);
                         throw new Error(errorText || `Erro HTTP ao buscar serviços oferecidos: ${response.status}`);
                    }

                    const servicos = await response.json();
                    console.log("Serviços oferecidos carregados:", servicos);

                    if (servicos.length === 0) {
                         empty.style.display = 'block';
                    } else {
                        empty.style.display = 'none';
                         servicos.forEach(servico => {
                             adicionarServicoUI(servico);
                         });
                    }


                } catch (error) {
                    console.error("Erro ao carregar serviços oferecidos:", error);
                    feedback.textContent = `Erro ao carregar serviços: ${error.message || 'Verifique a conexão.'}`;
                    feedback.style.display = "block";
                    empty.style.display = 'none';
                } finally {
                    loading.style.display = "none";
                }
            }

            // Função para adicionar um serviço à lista na UI
            function adicionarServicoUI(servico) {
                 const servicesList = document.getElementById("services-list");
                 const serviceItem = document.createElement('div');
                 serviceItem.classList.add('service-item');
                 serviceItem.setAttribute('data-id', servico._id); // Armazena o ID do backend

                 const precoTexto = (servico.faixa_preco_min !== undefined && servico.faixa_preco_max !== undefined)
                                    ? `R$ ${servico.faixa_preco_min.toFixed(2).replace('.', ',')} - R$ ${servico.faixa_preco_max.toFixed(2).replace('.', ',')}`
                                    : (servico.faixa_preco_min !== undefined ? `A partir de R$ ${servico.faixa_preco_min.toFixed(2).replace('.', ',')}` : 'Preço a combinar');


                 serviceItem.innerHTML = `
                     <div class="service-details">
                         <h6>${servico.nome || 'Serviço sem Nome'}</h6>
                         <p>${servico.descricao || 'Sem descrição.'}</p>
                         <p>Faixa de Preço: ${precoTexto}</p>
                         <p>Categorias: ${servico.categorias?.join(', ') || 'Nenhuma'}</p>
                     </div>
                     <div class="service-actions">
                         <button class="btn btn-sm btn-primary edit-service" data-id="${servico._id}">Editar</button>
                         <button class="btn btn-sm btn-danger delete-service" data-id="${servico._id}">Excluir</button>
                     </div>
                 `;

                 servicesList.appendChild(serviceItem);
            }


            // Listener para o botão "Adicionar Novo Serviço"
            document.getElementById("add-service-btn").addEventListener("click", () => {
                 // Limpa o formulário do modal e abre para adicionar novo serviço
                 document.getElementById('service-id').value = '';
                 document.getElementById('service-name').value = '';
                 document.getElementById('service-description').value = '';
                 document.getElementById('service-price-min').value = '';
                 document.getElementById('service-price-max').value = '';
                 document.getElementById('service-categories').value = '';
                 document.getElementById('serviceModalLabel').textContent = 'Adicionar Novo Serviço';
                 $('#serviceModal').modal('show');
            });

            // Listener para os botões de ação (Editar/Excluir) usando delegação de evento
            document.getElementById("services-list").addEventListener("click", async (event) => {
                 const target = event.target;
                 const serviceId = target.dataset.id;
                 const token = localStorage.getItem("token");
                 // Não precisamos do prestadorId aqui, o backend pega do token

                 if (!serviceId || !token) {
                      console.warn("Ação de serviço clicada sem ID ou token.", { serviceId, hasToken: !!token });
                      return;
                 }

                 // Ação de Editar Serviço
                 if (target.classList.contains("edit-service")) {
                      event.preventDefault();
                      console.log("Editar serviço:", serviceId);

                      try {
                          // --- ROTA CORRIGIDA: Não inclui prestadorId na URL ---
                          // --- URL ATUALIZADA PARA O BACKEND NO RENDER ---
                          const response = await fetch(`https://wyn-backend.onrender.com/prestador/servicos-oferecidos/${serviceId}`, {
                              headers: { 'Authorization': `Bearer ${token}` }
                          });

                          if (!response.ok) {
                               const errorText = await response.text();
                               console.error("Erro HTTP ao buscar serviço para edição:", response.status, errorText);
                               throw new Error(errorText || `Erro HTTP: ${response.status}`);
                          }

                          const servico = await response.json();
                          console.log("Dados do serviço para edição:", servico);

                          // Preenche o modal com os dados do serviço
                          document.getElementById('service-id').value = servico._id;
                          document.getElementById('service-name').value = servico.nome || '';
                          document.getElementById('service-description').value = servico.descricao || '';
                          document.getElementById('service-price-min').value = servico.faixa_preco_min !== undefined ? servico.faixa_preco_min : '';
                          document.getElementById('service-price-max').value = servico.faixa_preco_max !== undefined ? servico.faixa_preco_max : '';
                          document.getElementById('service-categories').value = servico.categorias?.join(', ') || '';
                          document.getElementById('serviceModalLabel').textContent = 'Editar Serviço';

                          $('#serviceModal').modal('show'); // Abre o modal

                      } catch (error) {
                          console.error("Erro ao carregar dados do serviço para edição:", error);
                          showToast(error.message || "Erro ao carregar dados do serviço para edição.", 'danger');
                      }

                 }

                 // Ação de Excluir Serviço
                 if (target.classList.contains("delete-service")) {
                      event.preventDefault();
                      console.log("Excluir serviço:", serviceId);

                      if (!confirm("Tem certeza que deseja excluir este serviço? Esta ação não pode ser desfeita.")) return;

                      try {
                           // --- ROTA CORRIGIDA: Não inclui prestadorId na URL ---
                           // --- URL ATUALIZADA PARA O BACKEND NO RENDER ---
                          const response = await fetch(`https://wyn-backend.onrender.com/prestador/servicos-oferecidos/${serviceId}`, {
                              method: "DELETE",
                              headers: {
                                  'Authorization': `Bearer ${token}` // Incluir token
                              },
                          });

                          const result = await response.json(); // Leia a resposta JSON

                          if (!response.ok) {
                               showToast(result.message || `Erro ao excluir serviço.`, 'danger');
                               console.error("Erro ao excluir serviço:", result);
                          } else {
                              showToast(result.message || "Serviço excluído com sucesso!", 'success');
                              carregarServicosOferecidos(); // Recarrega a lista
                          }

                      } catch (error) {
                          console.error("Erro ao excluir serviço:", error);
                          showToast(error.message || "Erro ao excluir serviço.", 'danger');
                      }
                 }
            });


            // Listener para o formulário do modal de serviço (Adicionar/Editar)
            document.getElementById("service-form").addEventListener("submit", async (event) => {
                 event.preventDefault();

                 const form = event.target;
                 const submitButton = form.querySelector('button[type="submit"]');
                 submitButton.disabled = true;
                 submitButton.textContent = "Salvando...";

                 const token = localStorage.getItem("token");
                 // Não precisamos do prestadorId aqui, o backend pega do token
                 const serviceId = document.getElementById('service-id').value; // ID do serviço (vazio para novo)

                 if (!token) {
                      showToast("Erro: Usuário não autenticado.", 'danger');
                      submitButton.disabled = false;
                      submitButton.textContent = "Salvar Serviço";
                      return;
                 }

                 const nome = document.getElementById("service-name").value;
                 const descricao = document.getElementById("service-description").value;
                 const faixaPrecoMin = document.getElementById("service-price-min").value;
                 const faixaPrecoMax = document.getElementById("service-price-max").value;
                 const categorias = document.getElementById("service-categories").value.split(',').map(cat => cat.trim()).filter(cat => cat !== ''); // Divide por vírgula e remove espaços/vazios

                 // Validação básica
                 if (!nome) {
                      showToast("Por favor, preencha o nome do serviço.", 'danger');
                      submitButton.disabled = false;
                      submitButton.textContent = "Salvar Serviço";
                      return;
                 }

                 const serviceData = {
                     nome: nome,
                     descricao: descricao,
                     faixa_preco_min: faixaPrecoMin ? parseFloat(faixaPrecoMin) : undefined, // Envia como número ou undefined
                     faixa_preco_max: faixaPrecoMax ? parseFloat(faixaPrecoMax) : undefined, // Envia como número ou undefined
                     categorias: categorias
                 };

                 try {
                     let response;
                     let method;
                     let url;

                     if (serviceId) { // Se tem ID, é uma edição (PUT)
                         method = 'PUT';
                         // --- ROTA CORRIGIDA: Não inclui prestadorId na URL ---
                         // --- URL ATUALIZADA PARA O BACKEND NO RENDER ---
                         url = `https://wyn-backend.onrender.com/prestador/servicos-oferecidos/${serviceId}`;
                     } else { // Se não tem ID, é uma adição (POST)
                         method = 'POST';
                         // --- ROTA CORRIGIDA: Não inclui prestadorId na URL ---
                         // --- URL ATUALIZADA PARA O BACKEND NO RENDER ---
                         url = `https://wyn-backend.onrender.com/prestador/servicos-oferecidos`; // Endpoint para adicionar serviço a um prestador
                     }

                     response = await fetch(url, {
                         method: method,
                         headers: {
                             'Content-Type': 'application/json',
                             'Authorization': `Bearer ${token}`
                         },
                         body: JSON.stringify(serviceData)
                     });

                     const result = await response.json();

                     if (!response.ok) {
                          showToast(result.message || `Erro ao ${serviceId ? 'atualizar' : 'adicionar'} serviço.`, 'danger');
                          console.error(`Erro ao ${serviceId ? 'atualizar' : 'adicionar'} serviço:`, result);
                     } else {
                         showToast(`Serviço ${serviceId ? 'atualizado' : 'adicionado'} com sucesso!`, 'success');
                         $('#serviceModal').modal('hide'); // Fecha o modal
                         carregarServicosOferecidos(); // Recarrega a lista para atualizar a UI
                     }

                 } catch (error) {
                     console.error(`Erro ao ${serviceId ? 'atualizar' : 'adicionar'} serviço:`, error);
                     showToast(error.message || `Erro ao ${serviceId ? 'atualizar' : 'adicionar'} serviço.`, 'danger');
                 } finally {
                     submitButton.disabled = false;
                     submitButton.textContent = "Salvar Serviço";
                 }
            });


			// Chamar carregarPerfilPrestador ao carregar a página
			document.addEventListener("DOMContentLoaded", () => {
				 carregarPerfilPrestador();
			});

            // Opcional: Parar o polling ao fechar a janela/aba
            window.addEventListener('beforeunload', () => {
                 pararPollingMensagensNaoLidas();
            });

		</script>


	</body>
</html>
