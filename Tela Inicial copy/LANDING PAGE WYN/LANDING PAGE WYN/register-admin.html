<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>WYN - Cadastro de Administrador</title>

    <link
        rel="apple-touch-icon"
        sizes="180x180"
        href="/Tela Inicial copy/w.png"
    />
    <link
        rel="icon"
        type="image/png"
        sizes="32x32"
        href="/Tela Inicial copy/w.png"
    />
    <link
        rel="icon"
        type="image/png"
        sizes="16x16"
        href="/Tela Inicial copy/w.png"
    />

    <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
    />

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="vendors/styles/core.css" />
    <link
        rel="stylesheet"
        type="text/css"
        href="vendors/styles/icon-font.min.css"
    />
    <link rel="stylesheet" type="text/css" href="vendors/styles/style.css" />

    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != "dataLayer" ? "&l=" + l : "";
            j.async = true;
            j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, "script", "dataLayer", "GTM-NXZMQSS");
    </script>
    </head>

<body class="login-page">
    <div class="login-header box-shadow">
        <div
            class="container-fluid d-flex justify-content-between align-items-center"
        >
            <div class="brand-logo">
                 <a href="index.html">
                    <img src="/Tela Inicial copy/w.png" alt="" />
                </a>
            </div>
            <div class="login-menu">
                <ul>
                    <li><a href="login-admin.html">Login Admin</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div
        class="register-page-wrap d-flex align-items-center flex-wrap justify-content-center"
    >
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 col-lg-7">
                    <img src="/Tela Inicial copy/w (1).png" alt="" />
                </div>
                <div class="col-md-6 col-lg-5">
                    <div class="register-box bg-white box-shadow border-radius-10">
                        <div class="login-title">
                            <h2 class="text-center text-primary">Cadastrar Novo Administrador</h2>
                        </div>
                        <form id="adminRegisterForm">
                            <div class="form-group row">
                                <label class="col-sm-12 col-md-4 col-form-label">Nome Completo*</label>
                                <div class="col-sm-12 col-md-8">
                                    <input type="text" class="form-control" id="nome" required />
                                </div>
                            </div>
                             <div class="form-group row">
                                 <label class="col-sm-12 col-md-4 col-form-label">Email*</label>
                                 <div class="col-sm-12 col-md-8">
                                     <input type="email" class="form-control" id="email" required />
                                 </div>
                             </div>
                             <div class="form-group row">
                                 <label class="col-sm-12 col-md-4 col-form-label">Senha*</label>
                                 <div class="col-sm-12 col-md-8">
                                     <input type="password" class="form-control" id="password" required />
                                 </div>
                             </div>
                             <div class="form-group row">
                                 <label class="col-sm-12 col-md-4 col-form-label">Confirmar Senha*</label>
                                 <div class="col-sm-12 col-md-8">
                                     <input type="password" class="form-control" id="confirmPassword" required />
                                 </div>
                             </div>
                             <div class="form-group row">
                                 <label class="col-sm-12 col-md-4 col-form-label">Telefone</label>
                                 <div class="col-sm-12 col-md-8">
                                     <input type="text" class="form-control" id="telefone" />
                                 </div>
                             </div>
                             <div class="form-group row">
                                 <label class="col-sm-12 col-md-4 col-form-label">Foto de Perfil</label>
                                 <div class="col-sm-12 col-md-8">
                                     <input type="file" class="form-control-file" id="fotoPerfil" accept="image/*" />
                                 </div>
                             </div>

                             <input type="hidden" id="isAdmin" name="isAdmin" value="true">

                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="input-group mb-0">
                                        <input class="btn btn-primary btn-lg btn-block" type="submit" value="Cadastrar Admin" />
                                    </div>
                                    <div id="registerMessage" class="text-center mt-3"></div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <noscript
        ><iframe
            src="https://www.googletagmanager.com/ns.html?id=GTM-NXZMQSS"
            height="0"
            width="0"
            style="display: none; visibility: hidden"
        ></iframe
    ></noscript>
    <script src="vendors/scripts/core.js"></script>
    <script src="vendors/scripts/script.min.js"></script>
    <script src="vendors/scripts/process.js"></script>
    <script src="vendors/scripts/layout-settings.js"></script>

    <script>
        // Listener para o formulário de cadastro
        document.getElementById('adminRegisterForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // Previne o recarregamento da página

            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const telefone = document.getElementById('telefone').value;
            const fotoPerfilInput = document.getElementById('fotoPerfil');
            const fotoPerfilFile = fotoPerfilInput.files[0]; // Pega o arquivo de foto
            const isAdmin = document.getElementById('isAdmin').value; // Pega o valor do campo hidden
            const messageDiv = document.getElementById('registerMessage');

            // Limpa mensagens anteriores
            messageDiv.textContent = '';
            messageDiv.className = 'text-center mt-3'; // Reseta classes de cor

            // Validação básica de senha
            if (password !== confirmPassword) {
                messageDiv.textContent = 'As senhas não coincidem.';
                messageDiv.classList.add('text-danger');
                return;
            }

            // Cria um objeto FormData para enviar dados, incluindo o arquivo
            const formData = new FormData();
            formData.append('nome', nome);
            formData.append('email', email);
            formData.append('senha', password); // Envia a senha
            formData.append('telefone', telefone);
            formData.append('isAdmin', isAdmin); // Envia a flag isAdmin
            if (fotoPerfilFile) {
                formData.append('foto_perfil', fotoPerfilFile); // Adiciona o arquivo se existir
            }

            // Obtém o token do administrador logado (necessário para a rota /admin/usuarios)
            const token = localStorage.getItem('token');

            if (!token) {
                 messageDiv.textContent = 'Erro: Você precisa estar logado como administrador para cadastrar outro administrador.';
                 messageDiv.classList.add('text-danger');
                 console.error('Token de administrador não encontrado para cadastro.');
                 return;
            }


            try {
                // Envia os dados de cadastro para o backend usando a rota de admin
                const response = await fetch('http://localhost:3000/admin/usuarios', {
                    method: 'POST',
                    headers: {
                        // Não defina 'Content-Type': 'application/json' ao usar FormData com upload de arquivo
                        'Authorization': `Bearer ${token}` // Inclui o token do admin logado
                    },
                    body: formData, // Envia o FormData
                });

                const result = await response.json(); // Parseia a resposta JSON

                if (!response.ok) {
                    // Se a resposta não for OK
                    messageDiv.textContent = result.message || 'Erro no cadastro de administrador.';
                    messageDiv.classList.add('text-danger');
                    console.error('Erro no cadastro de administrador:', result);
                } else {
                    // Se o cadastro for bem-sucedido
                    messageDiv.textContent = result.message || 'Administrador cadastrado com sucesso!';
                    messageDiv.classList.add('text-success');
                    console.log('Cadastro de administrador bem-sucedido:', result);
                    // Opcional: Limpar o formulário ou redirecionar após sucesso
                    document.getElementById('adminRegisterForm').reset();
                    // Exemplo: Redirecionar para a tela de login de admin após 3 segundos
                     setTimeout(() => { window.location.href = 'login-admin.html'; }, 3000);
                }
            } catch (error) {
                // Captura erros de rede ou outros erros
                console.error('Erro na requisição de cadastro:', error);
                messageDiv.textContent = 'Ocorreu um erro na comunicação com o servidor.';
                messageDiv.classList.add('text-danger');
            }
        });
    </script>
</body>
</html>
